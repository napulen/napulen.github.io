<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.3.0 for Hugo"><meta name=author content="Néstor Nápoles López"><meta name=description content="A Hidden Markov Model (HMM) for retrieving the musical key of a MIDI file."><link rel=alternate hreflang=en-us href=/reports/mcgill/mumt621/><link rel=preconnect href=https://fonts.gstatic.com crossorigin><meta name=theme-color content="#1565c0"><script src=/js/mathjax-config.js></script><link rel=stylesheet href=/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin=anonymous media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload="this.media='all'" disabled><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload="this.media='all'"><link rel=stylesheet href=/css/wowchemy.c4d4d0fe4a8128c673e97327869a0f76.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-127095189-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}function trackOutboundLink(a,b){gtag('event','click',{event_category:'outbound',event_label:a,transport_type:'beacon',event_callback:function(){b!=='_blank'&&(document.location=a)}}),console.debug("Outbound link clicked: "+a)}function onClickCallback(a){if(a.target.tagName!=='A'||a.target.host===window.location.host)return;trackOutboundLink(a.target,a.target.getAttribute('target'))}gtag('js',new Date),gtag('config','UA-127095189-1',{}),gtag('set',{cookie_flags:'SameSite=None;Secure'}),document.addEventListener('click',onClickCallback,!1)</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu03a8b75004573f102e451e8733e2a105_6045_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu03a8b75004573f102e451e8733e2a105_6045_180x180_fill_lanczos_center_2.png><link rel=canonical href=/reports/mcgill/mumt621/><meta property="twitter:card" content="summary"><meta property="og:site_name" content="Néstor Nápoles López"><meta property="og:url" content="/reports/mcgill/mumt621/"><meta property="og:title" content="MUMT 621: Hidden Markov Model for Symbolic Key Detection | Néstor Nápoles López"><meta property="og:description" content="A Hidden Markov Model (HMM) for retrieving the musical key of a MIDI file."><meta property="og:image" content="/media/icon_hu03a8b75004573f102e451e8733e2a105_6045_512x512_fill_lanczos_center_2.png"><meta property="twitter:image" content="/media/icon_hu03a8b75004573f102e451e8733e2a105_6045_512x512_fill_lanczos_center_2.png"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2021-08-11T23:21:26-04:00"><title>MUMT 621: Hidden Markov Model for Symbolic Key Detection | Néstor Nápoles López</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=8ae9f13c8a136a626242b01fb18ce6dc><script src=/js/wowchemy-init.min.bb9394ade3949908af8ac334e87943b6.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class=page-header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Néstor Nápoles López</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Néstor Nápoles López</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/publication/><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/project/><span>Code</span></a></li><li class=nav-item><a class=nav-link href=/post/><span>Posts</span></a></li><li class=nav-item><a class="nav-link active" href=/reports/><span>Coursework</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class="nav-link js-set-theme-dark" href=# aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a></li></ul></div></nav></div><div class=page-body><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">McGill Coursework</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>Search...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li><a href=/reports/><i class="fas fa-arrow-left pr-1"></i>Coursework</a></li></ul><div class=docs-toc-item><a class=docs-toc-link href=/reports/mcgill/>McGill Coursework</a><ul class="nav docs-sidenav"><li><a href=/reports/mcgill/mumt501/>MUMT 501: Barberpole Phasing and Flanging Illusions</a></li><li><a href=/reports/mcgill/mumt615/>MUMT 615: Melodic Tension Experiment</a></li><li><a href=/reports/mcgill/mumt616/>MUMT 616: Inharmonicity</a></li><li><a href=/reports/mcgill/mumt618/>MUMT 618: Implementation of Boss DS-1</a></li><li><a href=/reports/mcgill/mumt620/>MUMT 620: Cadence Game</a></li><li class=active><a href=/reports/mcgill/mumt621/>MUMT 621: Hidden Markov Model for Symbolic Key Detection</a></li><li><a href=/reports/mcgill/muth251/>MUTH 251: Essay on Brahms Intermezzo Op.118 No.2</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><a href=#abstract>Abstract</a></li><li><a href=#introduction>Introduction</a></li><li><a href=#design-of-the-hidden-markov-model>Design of the Hidden Markov Model</a><ul><li><a href=#keys-as-hidden-states>Keys as hidden states</a></li><li><a href=#pitch-classes-as-observation-symbols>Pitch-classes as observation symbols</a></li></ul></li><li><a href=#parameters-of-the-model>Parameters of the model</a><ul><li><a href=#initial-probabilities>Initial probabilities</a></li><li><a href=#state-transitions>State transitions</a></li><li><a href=#emission-probabilities>Emission probabilities</a></li></ul></li><li><a href=#dataset>Dataset</a></li><li><a href=#results>Results</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><article class=article><div class=docs-article-container><nav class="d-none d-md-flex" aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/reports/>Coursework</a></li><li class=breadcrumb-item><a href=/reports/mcgill/>McGill Coursework</a></li><li class="breadcrumb-item active" aria-current=page>MUMT 621: Hidden Markov Model for Symbolic Key Detection</li></ol></nav><h1>MUMT 621: Hidden Markov Model for Symbolic Key Detection</h1><div class=article-style><p>A Hidden Markov Model (HMM) for retrieving the musical key of a MIDI file.</p><h2 id=abstract>Abstract</h2><p>During the course <a href=https://www.music.mcgill.ca/~ich/classes/mumt621_18/mumt621.html target=_blank rel=noopener>MUMT 621: Music Information Acquisition, Preservation, and Retrieval</a>, I designed and implemented a model for symbolic key detection.</p><p>The model was later extended to work with <strong>audio</strong> data and to retrieve <strong>local-key</strong> estimations as well. A <a href=/publication/keydetection19>dedicated entry in this website</a> exists for the extended version, which was published in the proceedings of DLfM 2019.</p><p>This document describes the original class project. A PDF version of this document is also <a href=/media/mumt621/hmm.pdf>available</a>.</p><h2 id=introduction>Introduction</h2><p>Finding the key of a piece of Western art music has been in the interest
of the Music Information Retrieval (MIR) community for several years
already. Since they were introduced, the design or acquisition of
key-profiles have been the preferred methodology to solve this problem.
In this project, we combine the use of key-profiles with the
capabilities of Hidden Markov Models (HMMs) to model the time-varying
aspects of music to find the key of a piece of music by considering the
pitch-class of every note in the piece as the observation symbol of an
HMM.</p><figure id=figure-states-and-observation-symbols-of-the-proposed-hmm-the-blue-states-represent-major-keys-the-red-states-represent-minor-keys-the-green-boxes-represent-the-twelve-pitch-classes><div class="d-flex justify-content-center"><div class=w-100><img alt="States and observation symbols of the proposed HMM. The blue states represent major keys, the red states represent minor keys, the green boxes represent the twelve pitch-classes" srcset="/media/mumt621/hmm_hue78f7b8d3da2831c1bd7cd19bdecfb69_55242_efbd8e60327821c76c9f2065eb1c1d69.png 400w,
/media/mumt621/hmm_hue78f7b8d3da2831c1bd7cd19bdecfb69_55242_6d13bc4f98f403af392eeef04270dc15.png 760w,
/media/mumt621/hmm_hue78f7b8d3da2831c1bd7cd19bdecfb69_55242_1200x1200_fit_lanczos_2.png 1200w" src=/media/mumt621/hmm_hue78f7b8d3da2831c1bd7cd19bdecfb69_55242_efbd8e60327821c76c9f2065eb1c1d69.png width=760 height=228 loading=lazy data-zoomable></div></div><figcaption data-pre=Figure&nbsp; data-post=:&nbsp; class=numbered>States and observation symbols of the proposed HMM. The blue states represent major keys, the red states represent minor keys, the green boxes represent the twelve pitch-classes</figcaption></figure><h2 id=design-of-the-hidden-markov-model>Design of the Hidden Markov Model</h2><p>As mentioned, the proposed HMM consists of 24 hidden states and 12
observation symbols.</p><h3 id=keys-as-hidden-states>Keys as hidden states</h3><p>The hidden states correspond to 24 different major and minor keys (i.e.,
no distinction between enharmonics), each of these keys is represented
as a hidden state in the model. All of the keys may transition to any of
the other 23 keys, however, the probability of transitioning to neighbor
keys in the circle of fifths is preferred over distant keys.</p><h3 id=pitch-classes-as-observation-symbols>Pitch-classes as observation symbols</h3><p>All major and minor keys are able to <em>emit</em> any of the twelve
pitch-classes before they transition to a new state, however, by
acquiring the probability distributions from common key-profiles used
for the task of key detection, the emission of <em>diatonic</em> tones of the
key are preferred over accidental tones.</p><figure id=figure-a-generic-overview-of-the-geometric-model-of-key-distance-starting-from-any-tonic><div class="d-flex justify-content-center"><div class=w-100><img alt="A generic overview of the geometric model of key distance, starting from any tonic" srcset="/media/mumt621/key_transitions_layers_huf88355d307b8c1fd56ee983d5cc14503_17480_30b3da11eba163a84d7d7ad2b81536bc.png 400w,
/media/mumt621/key_transitions_layers_huf88355d307b8c1fd56ee983d5cc14503_17480_faadca37b527519b97c4c0a10c554350.png 760w,
/media/mumt621/key_transitions_layers_huf88355d307b8c1fd56ee983d5cc14503_17480_1200x1200_fit_lanczos_2.png 1200w" src=/media/mumt621/key_transitions_layers_huf88355d307b8c1fd56ee983d5cc14503_17480_30b3da11eba163a84d7d7ad2b81536bc.png width=376 height=374 loading=lazy data-zoomable></div></div><figcaption data-pre=Figure&nbsp; data-post=:&nbsp; class=numbered>A generic overview of the geometric model of key distance, starting from any tonic</figcaption></figure><figure id=figure-the-key-distances-of-c-major><div class="d-flex justify-content-center"><div class=w-100><img alt="The key distances of C Major" srcset="/media/mumt621/key_transitions_hue58da6863373d45d70f700b32f6003ab_25224_6390e80bfa028d496b5fc833d56fa23c.png 400w,
/media/mumt621/key_transitions_hue58da6863373d45d70f700b32f6003ab_25224_a0dc5b0405143beb4caff84330359796.png 760w,
/media/mumt621/key_transitions_hue58da6863373d45d70f700b32f6003ab_25224_1200x1200_fit_lanczos_2.png 1200w" src=/media/mumt621/key_transitions_hue58da6863373d45d70f700b32f6003ab_25224_6390e80bfa028d496b5fc833d56fa23c.png width=377 height=376 loading=lazy data-zoomable></div></div><figcaption data-pre=Figure&nbsp; data-post=:&nbsp; class=numbered>The key distances of C Major</figcaption></figure><h2 id=parameters-of-the-model>Parameters of the model</h2><h3 id=initial-probabilities>Initial probabilities</h3><p>The initial probabilities of the model are the same for each key, $p(state) = \frac{1}{24}$.</p><h3 id=state-transitions>State transitions</h3><p>The probability distributions for state transitions that happen after
the initialization have been taken from a geometric model of key
distance. The probability of a transition to another key in the next
group of neighbors decreases exponentially. The geometric model of key
distance can be observed in</p><p>Using this model, we can observe, for example, a list of the groups of
neighbor keys for C Major, in descending order:</p><pre><code>Group   Keys
0       C
1       G F a c
2       d e f g
3       D Eb A Bb
4       E Ab bb b
5       Db B
6       eb f#
7       c# ab
8       F#
</code></pre><p>This structure of nine groups of neighbours repeats for all major and
minor keys. We can use these groups to compute the transition
probability for any key according to the following formula:</p><p>$$p(s) = \alpha^{(G-1) - s_g}$$</p><p>where $G$ is the number of groups of neighbor keys to the current
tonic, according to the geometric model (i.e., $G=9$), $s_g$ is the
group to which the key $s$ belongs, $\alpha$ is the probability
ratio between a key of one group and a key from a contiguous group.</p><figure id=figure-probability-distribution-for-the-next-state-if-the-current-state-is-c-major><div class="d-flex justify-content-center"><div class=w-100><img alt="Probability distribution for the next state if the current state is C Major" srcset="/media/mumt621/key_transitions_CMajor_hu98d87bcf83ce3b621ee74718275cc4a8_10020_5be111089714266fe49efeb107655d3e.png 400w,
/media/mumt621/key_transitions_CMajor_hu98d87bcf83ce3b621ee74718275cc4a8_10020_d4620a92ba452323dae5dc2e685cbd81.png 760w,
/media/mumt621/key_transitions_CMajor_hu98d87bcf83ce3b621ee74718275cc4a8_10020_1200x1200_fit_lanczos_2.png 1200w" src=/media/mumt621/key_transitions_CMajor_hu98d87bcf83ce3b621ee74718275cc4a8_10020_5be111089714266fe49efeb107655d3e.png width=654 height=389 loading=lazy data-zoomable></div></div><figcaption data-pre=Figure&nbsp; data-post=:&nbsp; class=numbered>Probability distribution for the next state if the current state is C Major</figcaption></figure><p>Figure 4 shows a plot of the probability distribution for the transition to the
next key, if the current key is C Major.</p><h3 id=emission-probabilities>Emission probabilities</h3><p>The emission probability distributions have been taken from the common
key-profiles used by other key detection algorithms. Particularly, we
considered the same five pairs of key-profiles used in the comparison by
Albrecht and Shanahan (2013).</p><h2 id=dataset>Dataset</h2><p>The model has been evaluated using sets of short musical compositions in
all major and minor keys. Each set follows the format of the
<em>Well-Tempered Clavier</em> by Johann Sebastian Bach. The sets are: The
Well-Tempered Clavier, Volume I, by Johann Sebastian Bach (24 MIDI
files); The Well-Tempered Clavier (Part II), by Johann Sebastian Bach
(24 MIDI files); Preludes Op.28, by Frédéric Chopin (24 midi files); 4
of the 24 preludes from Op.11, by Alexander Scriabin (4 MIDI files);
Preludes and Fugues Op.87, by Dmitri Shostakovich (48 MIDI files). In
total, 124 MIDI files were used for testing the algorithm.</p><p>Even if these MIDI files have not been explicitly annotated with their
keys and modulations, the main key of each of the selected pieces has
been clearly established by the composer in the original scores, meaning
an evaluation process of the algorithm is possible at least against the
main key of the musical piece.</p><h2 id=results>Results</h2><p>The best performance of the algorithm used a ratio of $\alpha = 10$,
the key-profiles from Temperley for major keys, and the key-profiles
from Sapp for minor keys. With this configuration, the algorithm guessed
correctly 103 out of 124 keys in the MIDI files from the dataset.</p><p>The worst performance of the algorithm used a ratio of $\alpha = 2$,
the key-profiles from Krumhansl and Kessler for major keys, and the
key-profiles from Aarden and Essen for the minor keys. With this
configuration, the algorithm guessed 49 out of 124 keys in the MIDI
files from the dataset.</p></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=/reports/mcgill/mumt620/ rel=next>MUMT 620: Cadence Game</a></div><div class=post-nav-item><div class=meta-nav>Next</div><a href=/reports/mcgill/muth251/ rel=prev>MUTH 251: Essay on Brahms Intermezzo Op.118 No.2</a></div></div></div></div><div class=body-footer><p>Last updated on Aug 11, 2021</p></div></article><footer class=site-footer><p class=powered-by>© 2021 Néstor Nápoles López</p><p class=powered-by>Website template based on George Cushen&rsquo;s <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a>.</p></footer></main></div></div></div><div class=page-footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/matlab.min.js crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script><script>anchors.add()</script><script id=search-hit-fuse-template type=text/x-template>
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/en/js/wowchemy.min.d2b0f682c23051fbfdb3b131afcba4c3.js></script></body></html>